$sourceFolder = "$env:USERPROFILE\kydras-governance"; $archiveFolder = "$env:USERPROFILE\kydras-compliance-service\archive"; New-Item -ItemType Directory -Path $archiveFolder -Force | Out-Null; $dashboards = Get-ChildItem $sourceFolder -Filter "executive_dashboard_*.html" | Sort-Object LastWriteTime -Descending; $latest = $dashboards | Select-Object -First 1; $old = $dashboards | Where-Object { $_.FullName -ne $latest.FullName }; foreach ($file in $old) { $timestamp = $file.LastWriteTime.ToString("yyyy-MM-dd_HHmm"); $archivedName = "dashboard_$timestamp.html"; Copy-Item $file.FullName -Destination "$archiveFolder\$archivedName" -Force; Write-Host "[Kydras] Archived â†’ $archivedName" }
$timestamp = Get-Date -Format "yyyy-MM-dd_HHmm"; $commit = git rev-parse --short HEAD; $bundleName = "kydras_artifacts_$timestamp_$commit.zip"; $bundlePath = "$env:USERPROFILE\kydras-compliance-service\artifacts\$bundleName"; New-Item -ItemType Directory -Path "$env:USERPROFILE\kydras-compliance-service\artifacts" -Force | Out-Null; Compress-Archive -Path @("$env:USERPROFILE\kydras-compliance-service\docs\index.html", "$env:USERPROFILE\kydras-compliance-service\docs\audit.md", "$env:USERPROFILE\kydras-compliance-service\README.md", "$env:USERPROFILE\kydras-compliance-service\deploy.log") -DestinationPath $bundlePath -Force; Write-Host "[Kydras] Governance bundle created â†’ $bundlePath"
$timestamp = Get-Date -Format "yyyy-MM-dd_HHmm"; $commit = git rev-parse --short HEAD; $bucket = "s3://kydras-compliance-exports"; $bundle = Get-ChildItem "$env:USERPROFILE\kydras-compliance-service\artifacts" -Filter "kydras_artifacts_*.zip" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; $pdf = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit.pdf"; aws s3 cp $bundle.FullName "$bucket/bundles/$($bundle.Name)" --metadata commit=$commit,timestamp=$timestamp; aws s3 cp $pdf.FullName "$bucket/pdfs/audit_$timestamp.pdf" --metadata commit=$commit,timestamp=$timestamp; Write-Host "[Kydras] Synced bundle + PDF to S3 â†’ $bucket"
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"; $commit = git rev-parse --short HEAD; $subject = "[Kydras] Compliance Bundle - $timestamp ($commit)"; $body = "Attached: Audit PDF, Governance Bundle, and Deploy Log.`nGenerated by CI/CD at $timestamp."; $bundle = Get-ChildItem "$env:USERPROFILE\kydras-compliance-service\artifacts" -Filter "kydras_artifacts_*.zip" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; $pdf = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit.pdf"; $log = Get-Item "$env:USERPROFILE\kydras-compliance-service\deploy.log"; Send-MailMessage -From "ci@kydras.com" -To "exec@kydras.com" -Subject $subject -Body $body -SmtpServer "smtp.kydras.com" -Attachments $pdf.FullName, $bundle.FullName, $log.FullName
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"
$commit = git rev-parse --short HEAD
$bundle = Get-ChildItem "$env:USERPROFILE\kydras-compliance-service\artifacts" -Filter "kydras_artifacts_*.zip" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
$pdf = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit.pdf"

$bundleUrl = "https://kydras-compliance-exports.s3.amazonaws.com/bundles/$($bundle.Name)"
$sanitizedTimestamp = $timestamp.Replace(':','').Replace(' ','_')
$pdfUrl = "https://kydras-compliance-exports.s3.amazonaws.com/pdfs/audit_$sanitizedTimestamp.pdf"

$payload = @{
    text = "[Kydras] Compliance artifacts ready ðŸŽ¯`nâ€¢ [Bundle]($bundleUrl)`nâ€¢ [Audit PDF]($pdfUrl)`nCommit: $commit | Time: $timestamp"
} | ConvertTo-Json -Compress

Invoke-RestMethod -Uri "https://hooks.slack.com/services/YOUR/WEBHOOK/URL" -Method Post -Body $payload -ContentType 'application/json'
$timestamp = Get-Date -Format "yyyy-MM-dd_HHmm"; $commit = git rev-parse --short HEAD; $bucket = "s3://kydras-compliance-exports"; $png = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.png" -ErrorAction SilentlyContinue; $pdf = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.pdf" -ErrorAction SilentlyContinue; if ($png) { aws s3 cp $png.FullName "$bucket/graphs/audit_trends_$timestamp.png" --metadata commit=$commit,timestamp=$timestamp }; if ($pdf) { aws s3 cp $pdf.FullName "$bucket/graphs/audit_trends_$timestamp.pdf" --metadata commit=$commit,timestamp=$timestamp }; Write-Host "[Kydras] Synced dashboard exports to S3 â†’ $bucket/graphs/"
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"; $commit = git rev-parse --short HEAD; $subject = "[Kydras] Audit Dashboard Export - $timestamp ($commit)"; $body = "Attached: Audit trend graphs (PNG + PDF)`nGenerated by CI/CD at $timestamp."; $png = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.png" -ErrorAction SilentlyContinue; $pdf = Get-Item "$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.pdf" -ErrorAction SilentlyContinue; if ($png -and $pdf) { Send-MailMessage -From "ci@kydras.com" -To "exec@kydras.com" -Subject $subject -Body $body -SmtpServer "smtp.kydras.com" -Attachments $png.FullName, $pdf.FullName; Write-Host "[Kydras] Dashboard exports emailed to exec@kydras.com" } else { Write-Warning "[Kydras] Dashboard exports not foundâ€”email skipped" }
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"; $commit = git rev-parse --short HEAD; $sanitized = $timestamp.Replace(":", "").Replace(" ", "_"); $pngUrl = "https://kydras-compliance-exports.s3.amazonaws.com/graphs/audit_trends_$sanitized.png"; $pdfUrl = "https://kydras-compliance-exports.s3.amazonaws.com/graphs/audit_trends_$sanitized.pdf"; $payload = @{ text = "[Kydras] Audit Dashboard Export ðŸ“Š`nâ€¢ [PNG]($pngUrl)`nâ€¢ [PDF]($pdfUrl)`nCommit: $commit | Time: $timestamp" } | ConvertTo-Json -Compress; Invoke-RestMethod -Uri "https://hooks.slack.com/services/YOUR/WEBHOOK/URL" -Method Post -Body $payload -ContentType 'application/json'
$cutoff = (Get-Date).AddDays(-30); $bucket = "kydras-compliance-exports"; $prefix = "graphs/"; $objects = aws s3api list-objects-v2 --bucket $bucket --prefix $prefix | ConvertFrom-Json; foreach ($obj in $objects.Contents) { $key = $obj.Key; $lastModified = Get-Date $obj.LastModified; if ($lastModified -lt $cutoff -and ($key -like "*audit_trends_*.png" -or $key -like "*audit_trends_*.pdf")) { aws s3 rm "s3://$bucket/$key"; Write-Host "[Kydras] Pruned old dashboard export â†’ $key" } }
$logPath = "$env:USERPROFILE\kydras-compliance-service\logs\export_log.json"; $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"; $commit = git rev-parse --short HEAD; function Write-Log($action, $file) { $entry = [pscustomobject]@{ timestamp = $timestamp; commit = $commit; action = $action; file = $file }; if (Test-Path $logPath) { $log = Get-Content $logPath | ConvertFrom-Json } else { $log = @() }; $log += $entry; $log | ConvertTo-Json -Depth 3 | Set-Content $logPath }
$bundlePath = "$env:USERPROFILE\kydras-compliance-service\artifacts\kydras_artifacts_latest.zip"; $sourceFiles = @("$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.png", "$env:USERPROFILE\kydras-compliance-service\docs\audit_trends.pdf", "$env:USERPROFILE\kydras-compliance-service\docs\trend_data.json", "$env:USERPROFILE\kydras-compliance-service\logs\export_log.json", "$env:USERPROFILE\kydras-compliance-service\README.md"); if (Test-Path $bundlePath) { Remove-Item $bundlePath }; Compress-Archive -Path $sourceFiles -DestinationPath $bundlePath; Write-Host "[Kydras] Governance bundle created â†’ $bundlePath"; Write-Log "Bundle Created" "kydras_artifacts_latest.zip"
$timestamp = Get-Date -Format "yyyy-MM-dd_HHmm"; $commit = git rev-parse --short HEAD; $bundleName = "kydras_artifacts_$timestamp.zip"; $bundlePath = "$env:USERPROFILE\kydras-compliance-service\artifacts\\$bundleName"; $latestPath = "$env:USERPROFILE\kydras-compliance-service\artifacts\\kydras_artifacts_latest.zip"; $sourceFiles = @("$env:USERPROFILE\kydras-compliance-service\docs\\audit_trends.png", "$env:USERPROFILE\kydras-compliance-service\docs\\audit_trends.pdf", "$env:USERPROFILE\kydras-compliance-service\docs\\trend_data.json", "$env:USERPROFILE\kydras-compliance-service\\logs\\export_log.json", "$env:USERPROFILE\kydras-compliance-service\\README.md"); if (Test-Path $bundlePath) { Remove-Item $bundlePath }; Compress-Archive -Path $sourceFiles -DestinationPath $bundlePath; Copy-Item -Path $bundlePath -Destination $latestPath -Force; Write-Host "[Kydras] Governance bundle created â†’ $bundleName"; Write-Log "Bundle Created" $bundleName
$timestamp = Get-Date -Format "yyyy-MM-dd_HHmm"; $commit = git rev-parse --short HEAD; $bundleName = "kydras_artifacts_$timestamp.zip"; $bundlePath = "$env:USERPROFILE\kydras-compliance-service\artifacts\\$bundleName"; $latestPath = "$env:USERPROFILE\kydras-compliance-service\artifacts\\kydras_artifacts_latest.zip"; $sourceFiles = @("$env:USERPROFILE\kydras-compliance-service\docs\\audit_trends.png", "$env:USERPROFILE\kydras-compliance-service\docs\\audit_trends.pdf", "$env:USERPROFILE\kydras-compliance-service\docs\\trend_data.json", "$env:USERPROFILE\kydras-compliance-service\\logs\\export_log.json", "$env:USERPROFILE\kydras-compliance-service\\README.md"); if (Test-Path $bundlePath) { Remove-Item $bundlePath }; Compress-Archive -Path $sourceFiles -DestinationPath $bundlePath; Copy-Item -Path $bundlePath -Destination $latestPath -Force; Write-Host "[Kydras] Governance bundle created â†’ $bundleName"; Write-Log "Bundle Created" $bundleName
$bundleKey = "artifacts/kydras_artifacts_$timestamp.zip"; $signedUrl = aws s3 presign "s3://kydras-compliance-exports/$bundleKey" --expires-in 86400; Write-Host "[Kydras] Signed bundle URL â†’ $signedUrl"; Write-Log "Signed URL Generated" $signedUrl
